<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Origin + Unicode Detector</title>
  <style>
    body {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      display: flex; flex-direction: column;
      align-items: center; padding: 40px 20px;
      min-height: 100vh;
    }
    textarea, input {
      width: 90%; max-width: 800px; margin: 10px 0;
      padding: 12px; border-radius: 6px; border: 1px solid #444;
      background: #1e2a38; color: #fff; font-family: monospace;
    }
    button {
      padding: 10px 20px; border: none; border-radius: 8px;
      background: #1abc9c; color: #fff; cursor: pointer;
    }
    button:disabled { background: #777; cursor: not-allowed; }
    #results, #aiResults { white-space: pre-wrap; margin-top: 1em; font-size: 1.1em; }
  </style>
</head>
<body>
  <h1>AI Origin + Unicode Detector</h1>
  <div id="ipInfo">Getting IP info...</div>
  <div>Daily uses remaining: <span id="remainingUses">...</span></div>
  <input type="password" id="code" placeholder="Enter secret code (optional)">
  <textarea id="input" placeholder="Paste text or code here..."></textarea>
  <button id="detectButton">Detect</button>
  <div id="results"></div>
  <div id="aiResults"></div>

  <script>
    let userIP = null;
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbymWMr_BrIAOyjw7qbSy45vnapDkzfAUrpPFIH-PzShiiBS3nbU32fJuXYMtET0-pWd/exec'; 

    async function getUserInfo() {
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        userIP = (await res.json()).ip;
        document.getElementById("ipInfo").innerText = `IP: ${userIP}`;
      } catch {
        userIP = "fp_" + Math.random().toString(36).slice(2);
        document.getElementById("ipInfo").innerText = "Offline mode (fingerprint only)";
      }
      updateUsage();
    }

    async function updateUsage() {
      const code = document.getElementById("code").value.trim();
      const params = new URLSearchParams({ action: 'get', ip: userIP, date: today(), code });
      const data = await (await fetch(`${webAppUrl}?${params}`)).json();
      document.getElementById("remainingUses").innerText = data.remaining ?? "N/A";
    }

    async function runDetection() {
      const input = document.getElementById("input").value.trim();
      const code = document.getElementById("code").value.trim();
      if (!input) return alert("⚠️ Please enter some text!");

      const btn = document.getElementById("detectButton");
      btn.disabled = true; btn.innerText = "Processing...";

      const params = new URLSearchParams({
        action: 'update', ip: userIP, date: today(), count: 1, code, input
      });
      const data = await (await fetch(`${webAppUrl}?${params}`)).json();

      document.getElementById("results").innerText = (data.unicodeResults || []).join("\n");
      document.getElementById("aiResults").innerText = `${data.verdict}\n\n${(data.clues || []).join("\n")}`;
      document.getElementById("remainingUses").innerText = data.remaining ?? "N/A";

      btn.disabled = false; btn.innerText = "Detect";
    }

    function today() {
      return new Date().toISOString().split("T")[0];
    }

    document.getElementById("detectButton").addEventListener("click", runDetection);
    document.addEventListener("DOMContentLoaded", getUserInfo);
  </script>
</body>
</html>
